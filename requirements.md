# Anki AI Chat Tool - 需求文档

## 项目概述
为Anki创建一个AI聊天工具，允许用户对当前卡片内容进行AI提问，并将对话结果保存到卡片中。

## 核心功能需求

### 1. 用户界面
- 在Anki显示背面答案的界面中添加"askAI"按钮
- 点击按钮后弹出聊天窗口
- 聊天窗口支持用户输入和AI回复显示

### 2. AI集成
- 使用OpenAI API进行对话
- 将当前卡片的正面和背面内容作为初始上下文
- 支持多轮对话

### 3. 数据处理
- 获取当前卡片的正面和背面信息
- 将用户提问和AI回答添加到卡片内容中
- 保持对话历史的完整性

## 技术实现要求

### 伪代码结构

```
// 主要组件
AnkiAIChatAddon {
    // 初始化
    initialize() {
        注册按钮到Anki界面
        设置OpenAI API配置
    }
    
    // 按钮点击处理
    onAskAIButtonClick() {
        获取当前卡片内容
        创建聊天窗口
        初始化AI上下文
    }
    
    // 聊天功能
    ChatWindow {
        显示对话界面
        处理用户输入
        调用AI API
        显示AI回复
        保存对话到卡片
    }
    
    // AI API集成
    OpenAIService {
        配置API密钥（硬编码占位符）
        发送请求到OpenAI
        处理响应
        错误处理
    }
    
    // 卡片数据操作
    CardDataManager {
        获取当前卡片信息
        更新卡片内容
        保存修改
    }
}
```

## 核心验证点

1. **卡片信息获取**：确保能正确获取当前卡片的正面和背面内容
2. **AI对话功能**：验证用户提问和AI回答的完整流程
3. **内容保存**：确认新对话能正确添加到卡片中
4. **界面集成**：验证askAI按钮和聊天窗口的正确显示

## 待澄清的问题

1. 对话内容添加到卡片的具体位置和格式
2. askAI按钮的确切位置
3. 聊天窗口的样式和大小要求
4. 使用的OpenAI模型版本
5. 错误处理策略

## 技术栈
- Anki插件开发框架
- Python (Anki插件语言)
- OpenAI API
- Qt (Anki界面框架)

## 开发阶段
1. 环境搭建和项目结构创建
2. 基础UI组件开发
3. AI API集成
4. 卡片数据操作实现
5. 功能测试和调试
